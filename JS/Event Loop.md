## 자바스크립트는 싱글 스레드 언어인데, 어떻게 동시에 여러 작업들을 수행하나요?

자바스크립트는 싱글 스레드 언어로 하나의 호출 스택을 사용해 코드를 순차적으로 실행합니다.
자바스크립트는 인터프리터 언어로서 코드를 한 줄씩 읽고 처리하여 한 번에 하나의 작업만 처리할 수 있습니다.
하지만 비동기 처리와 런타임 환경의 도움을 받아 여러 작업을 동시에 수행하는 것 처럼 동작할 수 있습니다.
**이벤트 루프**와 런타임 환경의 **비동기 처리**를 통해 이를 가능하게 합니다.

### 콜 스택과 싱글 스레드

자바스크립트 엔진은 코드를 실행할 때 함수 호출을 콜 스택에 쌓고 스택의 최상단 작업부터 하나씩 처리합니다.
동기적으로 진행되며 모든 작업이 완료될 때까지 순차적으로 처리합니다.
시간이 오래 걸리는 작업을 동기적으로 처리하면 프로그램이 멈추는 문제가 생깁니다.
이를 해결하기 위해 자바스크립트는 비동기 작업을 런타임 환경에 위임합니다.

### 런타임 환경과 비동기 처리

자바스크립트의 대표적인 런타임으로는 웹 브라우저와 Node.js가 있습니다.
웹 브라우저는 **Web API**를 사용해 비동기 작업을 처리하고 Node.js는 **libuv** 라이브러리를 사용해 비동기 작업을 처리합니다.

### 이벤트 루프

자바스크립트의 동시성을 가능하게 하는 핵심은 **이벤트 루프**입니다.
이벤트 루프는 콜 스택, 태스크 큐를 사용해 비동기 작업을 적절하게 처리합니다.

1. 자바스크립트 엔진이 코드를 실행하며 콜 스택에 이벤트를 쌓습니다.
2. 비동기 작업(예: `setTimeout` `fetch`)을 만나면 이를 Web API에 위임합니다.
3. 런타임 환경에서 비동기 작업이 완료되면 해당 콜백 함수가 태스크 큐에 추가됩니다.
4. 콜 스택이 비어 있으면 이벤트 루프는 큐에서 대기 중인 작업을 꺼내 콜 스택으로 이동시킵니다.
5. 이 과정을 반복하며 여러 작업이 동시에 실행되는 것처럼 보이게 합니다.

이 메커니즘 덕에 자바스크립트는 싱글 스레드임에도 불구하고 비동기적으로 여러 작업을 효율적으로 처리할 수 있습니다.

### 태스크 큐와 마이크로태스크 큐

비동기 작업의 콜백은 두 가지 큐에 저장됩니다.
* 태스크 큐
  * 일반적인 비동기 작업의 콜백이 저장됩니다.
  * `setTimeout`, `setInterval`, DOM 이벤트 핸들러
  * 이벤트 루프는 콜 스택이 비었을 때 태스크 큐에서 하나의 작업을 처리합니다.
* 마이크태스크 큐
  * 더 높은 우선순위를 가진 비동기 작업의 콜백이 저장됩니다.
  * `Promise.then`, `MutationObserver`, `queueMicrotask`
  * 이벤트 루프는 콜 스택이 비었을 때, 태스크 큐를 처리하기 전에 마이크로태스크 큐의 모든 작업을 먼저 처리합니다.


자바스크립트는 싱글 스레드 언어이지만 이벤트 루프와 런타임 환경의 비동기 처리 기능을 통해 동시성을 구현합니다.
콜 스택에서 동기 작업을 처리하고 Web API나 libuv를 통해 비동기 작업을 위임하여 이벤트 루프가 태스크 큐와 마이크로태스크 큐를 관리해 작업을 적절히 처리합니다.
이로 인해 네트워크 요청, 타이머, 사용자 입력 등 여러 작업을 동시에 처리하는 것처럼 보이게 됩니다.
